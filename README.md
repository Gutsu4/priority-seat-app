# 優先席アシスト

優先席における健常者と優先席を必要とする方の間のコミュニケーションコストを低減するためのAndroidアプリケーションです。

## 概要

### 解決したい課題

優先席において、以下のようなコミュニケーション上の課題が存在します：

- **健常者の立場**: 席を譲りたいけれど、相手に断られることを心配して声をかけづらい
- **席を必要とする方の立場**: 席を譲ってほしいけれど、座っている人に何か事情があるかもしれないと考え、声をかけづらい

このアプリは、Bluetooth Low Energy (BLE)技術を活用して、言葉によるコミュニケーションなしに双方の意思を伝え合うことを可能にします。

## 主な機能

### 1. 二つのモード

#### 🟦 席を譲れるモード（健常者向け）
- バックグラウンドで周囲をスキャン
- 近くに「席を譲ってほしい」モードのユーザーを検出すると通知

#### 🟥 席を譲ってほしいモード（優先席を必要とする方向け）
- BLE信号を周囲にアドバタイズ
- 「席を譲れる」モードのユーザーに自動的に存在を通知

### 2. プライバシー配慮設計

- 個人情報の送信なし
- 匿名のBLE信号のみを使用
- 位置情報の収集なし

### 3. バックグラウンド動作

- Foreground Serviceとして動作
- 優先席に座るときに起動すれば、アプリを開いていなくても自動的に検出・通知

## 技術仕様

### 使用技術

- **言語**: Kotlin
- **UI**: Jetpack Compose
- **通信**: Bluetooth Low Energy (BLE)
  - カスタムUUID: `0000FFF0-0000-1000-8000-00805F9B34FB`
- **アーキテクチャ**: Android Foreground Service

### 必要な権限

- `BLUETOOTH_SCAN` (Android 12+)
- `BLUETOOTH_ADVERTISE` (Android 12+)
- `BLUETOOTH_CONNECT` (Android 12+)
- `POST_NOTIFICATIONS` (Android 13+)
- `USE_FULL_SCREEN_INTENT` (Android 14+)

### 対応OS

- Android 5.0 (API 21) 以上
- BLE対応デバイス必須

## 使い方

1. **アプリを起動**
   - 初回起動時に必要な権限を許可

2. **モードを選択**
   - 「席を譲れる」または「席を譲ってほしい」を選択

3. **優先席に座る**
   - アプリはバックグラウンドで動作し続けます

4. **通知を受け取る**
   - 「席を譲れる」モードの場合: 近くに席を必要とする方がいると通知
   - 自然なコミュニケーションのきっかけに

## プロジェクト構造

```
app/src/main/java/com/example/push_notification_demo/
├── MainActivity.kt              # メインUIとユーザー操作
├── PrioritySeatService.kt       # BLEスキャン/アドバタイズを管理するサービス
├── MockBleManager.kt           # エミュレータ用のBLEモック実装
└── ui/theme/                    # UIテーマ定義
```

### 主要コンポーネント

#### MainActivity (`MainActivity.kt:35`)
- Jetpack Composeを使用したUI
- ユーザーモード選択
- 通知の表示とアラートダイアログ

#### PrioritySeatService (`PrioritySeatService.kt:15`)
- Foreground Serviceとして動作
- BLEスキャン/アドバタイズの管理
- 通知の送信とスロットリング（30秒間隔）

#### MockBleManager (`MockBleManager.kt`)
- エミュレータでのテスト用
- 実機なしでもアプリの動作を確認可能

## 開発環境

### ビルド方法

```bash
# デバッグビルド
./gradlew assembleDebug

# リリースビルド
./gradlew assembleRelease
```

### テスト

```bash
# ユニットテスト
./gradlew test

# Instrumentedテスト
./gradlew connectedAndroidTest
```

### エミュレータでのテスト

BLEが使用できないエミュレータでは、自動的にモックモードで動作します：
- テストモードのバナーが表示
- 「テスト通知を送信」ボタンで通知の動作を確認可能

## プライバシーとセキュリティ

- 個人を特定できる情報は一切送信されません
- 通信範囲はBLEの到達範囲（約10m）に限定
- デバイスIDも暗号化されたアドレスを使用
- 通知スロットリングにより、同じデバイスからの連続通知を防止

## 今後の展開

- [ ] より詳細な状況の伝達（例：「妊娠中」「怪我」など）
- [ ] 多言語対応
- [ ] アクセシビリティ機能の強化
- [ ] iOS版の開発

## ライセンス

このプロジェクトは個人開発プロジェクトです。

## お問い合わせ

バグ報告や機能要望は、GitHubのIssuesでお願いします。

---

**注意**: このアプリは優先席でのコミュニケーションを補助するツールです。実際に席を譲るかどうかの判断は、最終的にユーザー自身が行ってください。
